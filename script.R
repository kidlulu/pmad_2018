library(RODBC)
library(dplyr)
library(srvyr)
library(stringr)
rm(list = ls())
db <- odbcConnect("db_codeplan2", uid=35866, pwd='Meliodas083')
sqlTables(db) %>% 
  filter(TABLE_SCHEM=="pmad2018") %>%
  select(TABLE_NAME)

d <- sqlQuery(db,"select * from pmad2018.domicilios_1023")

str_detect(colnames(d),'C01')

colnames(d)[str_detect(colnames(d),'C01'),]

domicilio <- d %>% 
  mutate(tipo=factor(case_when(trimws(tipo)=='Tipo.1'~10,
                               trimws(tipo)=='Tipo.2'~20,
                               trimws(tipo)=='Tipo.3'~30,
                               trimws(tipo)=='Tipo.4'~40,
                               trimws(tipo)=='Tipo.5'~50,
                               trimws(tipo)=='Tipo.6'~60,
                               trimws(tipo)=='Tipo.7A'~71,
                               trimws(tipo)=='Tipo.7B'~72,
                               trimws(tipo)=='Tipo.7C'~73,
                               trimws(tipo)=='Tipo.7D'~74,
                               trimws(tipo)=='Tipo.8'~80)),
         B01=factor(case_when(trimws(B01)=='B01.1'~1,
                              trimws(B01)=='B01.2'~2,
                              trimws(B01)=='B01.3'~3),
                    labels=c('1 - Permanente',
                             '2 - Improvisado',
                             '3 - Permanente em construção')),
         B02=factor(case_when(trimws(B02)=='B02.1'~1,
                                  trimws(B02)=='B02.2'~2,
                                  trimws(B02)=='B02.3'~3,
                                  trimws(B02)=='B02.4'~4,
                                  trimws(B02)=='B02.5'~5,
                                  trimws(B02)=='B02.6'~6,
                                  trimws(B02)=='B02.7'~7,
                                  trimws(B02)=='B02.8'~8)),
         B03=as.numeric(case_when(trimws(B03)=='B03.1'~1,
                                  trimws(B03)=='B03.2'~2,
                                  trimws(B03)=='B03.3'~3,
                                  trimws(B03)=='B03.4'~4,
                                  trimws(B03)=='B03.5'~5,
                                  trimws(B03)=='B03.6'~6,
                                  trimws(B03)=='B03.7'~7,
                                  trimws(B03)=='B03.8'~8,
                                  trimws(B03)=='B03.9'~9,
                                  trimws(B03)=='B03.10'~10,
                                  trimws(B03)=='B03.11'~11,
                                  trimws(B03)=='B03.12'~12,
                                  trimws(B03)=='B03.13'~13,
                                  trimws(B03)=='B03.14'~14,
                                  trimws(B03)=='B03.15'~15)),
         B04=as.numeric(case_when(trimws(B0477777)=='B04.77777'~77777,
                                  trimws(B0488888)=='B04.88888'~88888,
                                  B041>=0~B041)),
         B05=as.numeric(case_when(trimws(B0577777)=='B05.77777'~77777,
                                  trimws(B0588888)=='B05.88888'~88888,
                                  B051>=0~B051)),
         B06=as.numeric(case_when(trimws(B06)=='B06.0'~0,
                                  trimws(B06)=='B06.1'~1,
                                  trimws(B06)=='B06.2'~2,
                                  trimws(B06)=='B06.3'~3,
                                  trimws(B06)=='B06.4'~4,
                                  trimws(B06)=='B06.5'~5,
                                  trimws(B06)=='B06.6'~6,
                                  trimws(B06)=='B06.7'~7)),
         B10=as.numeric(case_when(trimws(B10)=='B10.1'~1,
                                  trimws(B10)=='B10.2'~2,
                                  trimws(B10)=='B10.3'~3,
                                  trimws(B10)=='B10.4'~4)),
         B11=as.numeric(case_when(trimws(B11)=='B11.1'~1,
                                  trimws(B11)=='B11.2'~2,
                                  trimws(B11)=='B11.3'~3,
                                  trimws(B11)=='B11.4'~4,
                                  trimws(B11)=='B11.5'~5)),
         B12=as.numeric(case_when(trimws(B12)=='B12.1'~1,
                                  trimws(B12)=='B12.2'~2,
                                  trimws(B12)=='B12.3'~3,
                                  trimws(B12)=='B12.8'~8)),
         B13=as.numeric(case_when(trimws(B13)=='B13.1'~1,
                                  trimws(B13)=='B13.2'~2,
                                  trimws(B13)=='B13.3'~3,
                                  trimws(B13)=='B13.4'~4,
                                  trimws(B13)=='B13.8'~8)),
         B14=as.numeric(case_when(trimws(B14)=='B14.1'~1,
                                  trimws(B14)=='B14.2'~2,
                                  trimws(B14)=='B14.3'~3,
                                  trimws(B14)=='B14.4'~4)),
         B15=as.numeric(case_when(trimws(B15)=='B15.1'~1,
                                  trimws(B15)=='B15.2'~2,
                                  trimws(B15)=='B15.3'~3,
                                  trimws(B15)=='B15.8'~8)),
         B16=as.numeric(case_when(trimws(B16)=='B16.2'~2,
                                  trimws(B16)=='B16.3'~3,
                                  trimws(B16)=='B16.4'~4,
                                  trimws(B16)=='B16.8'~8)),
         B17=as.numeric(case_when(trimws(B17)=='B17.1'~1,
                                  trimws(B17)=='B17.2'~2,
                                  trimws(B17)=='B17.3'~3,
                                  trimws(B17)=='B17.4'~4,
                                  trimws(B17)=='B17.5'~5)),
         B18=as.numeric(case_when(trimws(B18)=='B18.1'~1,
                                  trimws(B18)=='B18.2'~2,
                                  trimws(B18)=='B18.3'~3,
                                  trimws(B18)=='B18.4'~4)),
         B19=as.numeric(case_when(trimws(B19)=='B19.0'~0,
                                  trimws(B19)=='B19.1'~1,
                                  trimws(B19)=='B19.2'~2,
                                  trimws(B19)=='B19.3'~3,
                                  trimws(B19)=='B19.4'~4,
                                  trimws(B19)=='B19.5'~5)),
         B20=as.numeric(case_when(trimws(B20)=='B20.0'~0,
                                  trimws(B20)=='B20.1'~1,
                                  trimws(B20)=='B20.2'~2,
                                  trimws(B20)=='B20.3'~3,
                                  trimws(B20)=='B20.4'~4,
                                  trimws(B20)=='B20.5'~5,
                                  trimws(B20)=='B20.6'~6)),
         B21=as.numeric(case_when(trimws(B21)=='B21.0'~0,
                                  trimws(B21)=='B21.1'~1,
                                  trimws(B21)=='B21.2'~2,
                                  trimws(B21)=='B21.3'~3,
                                  trimws(B21)=='B21.4'~4,
                                  trimws(B21)=='B21.5'~5,
                                  trimws(B21)=='B21.6'~6,
                                  trimws(B21)=='B21.7'~7,
                                  trimws(B21)=='B21.8'~8)),
         B22=as.numeric(case_when(trimws(B22)=='B22.0'~0,
                                  trimws(B22)=='B22.1'~1,
                                  trimws(B22)=='B22.2'~2,
                                  trimws(B22)=='B22.3'~3,
                                  trimws(B22)=='B22.4'~4,
                                  trimws(B22)=='B22.5'~5,
                                  trimws(B22)=='B22.8'~8)),
         B23=as.numeric(case_when(trimws(B23)=='B23.0'~0,
                                  trimws(B23)=='B23.1'~1,
                                  trimws(B23)=='B23.2'~2,
                                  trimws(B23)=='B23.3'~3,
                                  trimws(B23)=='B23.4'~4,
                                  trimws(B23)=='B23.8'~8)),
         C010=as.numeric(case_when(trimws(C010)=='C01.0'~0)),
         C011=as.numeric(C011),
         C012=as.numeric(C012),
         C013=as.numeric(C013),
         C014=as.numeric(C014),
         #         C015=as.numeric(C015),
         C016=as.numeric(C016),
         C017=as.numeric(C017),
         #         C018=as.numeric(C018),
         C019=as.numeric(C019),
         #         C020=as.numeric(case_when(trimws(C020)=='C02.0'~0)),
         C021=as.numeric(C021),
         C022=as.numeric(C022),
         C023=as.numeric(C023),
         C030=as.numeric(case_when(trimws(C030)=='C03.0'~0)),
         C031=as.numeric(C031),
         C032=as.numeric(C032),
         C033=as.numeric(C033),
         C034=as.numeric(C034),
         C0400=as.numeric(case_when(trimws(C0400)=='C04.00'~0)),
         C0401=as.numeric(C0401),
         C0402=as.numeric(C0402),
         C0403=as.numeric(C0403),
         C0404=as.numeric(C0404),
         C0405=as.numeric(C0405),
         C0406=as.numeric(C0406),
         C0407=as.numeric(C0407),
         C0408=as.numeric(C0408),
         C0409=as.numeric(C0409),
         C0410=as.numeric(C0410),
         C0411=as.numeric(C0411),
         C0412=as.numeric(C0412),
         C0413=as.numeric(C0413),
         C0414=as.numeric(C0414),
         C0415=as.numeric(C0415),
         C0416=as.numeric(C0416),
         C0417=as.numeric(C0417),
         C0418=as.numeric(C0418),
         C0419=as.numeric(C0419),
         C0420=as.numeric(C0420),
         C0421=as.numeric(C0421),
         C0422=as.numeric(C0422),
         C0477=as.numeric(case_when(trimws(C0477)=='C04.77'~77)),
         C050=as.numeric(case_when(trimws(C050)=='C05.0'~0)),
         #         C051=as.numeric(C051),
         C052=as.numeric(C052),
         C053=as.numeric(C053),
         C061=as.numeric(str_replace(trimws(C061),'C06.','')),
         C062=as.numeric(str_replace(trimws(C062),'C06.','')),
         C063=as.numeric(str_replace(trimws(C063),'C06.','')),
         C064=as.numeric(str_replace(trimws(C064),'C06.','')),
         C065=as.numeric(str_replace(trimws(C065),'C06.','')),
         C066=as.numeric(str_replace(trimws(C066),'C06.','')),
         C07=as.numeric(case_when(trimws(C07)=='C07.1'~1,
                                  trimws(C07)=='C07.2'~2,
                                  trimws(C07)=='C07.3'~3,
                                  trimws(C07)=='C07.8'~8)),
         C08=as.numeric(case_when(trimws(C08)=='C08.1'~1,
                                  trimws(C08)=='C08.2'~2,
                                  trimws(C08)=='C08.3'~3,
                                  trimws(C08)=='C08.4'~4,
                                  trimws(C08)=='C08.8'~8)),
         C09=as.numeric(case_when(trimws(C09)=='C09.01'~01,
                                  trimws(C09)=='C09.02'~02,
                                  trimws(C09)=='C09.03'~03,
                                  trimws(C09)=='C09.04'~04,
                                  trimws(C09)=='C09.05'~05,
                                  trimws(C09)=='C09.06'~06,
                                  trimws(C09)=='C09.07'~07,
                                  trimws(C09)=='C09.08'~08,
                                  trimws(C09)=='C09.09'~09,
                                  trimws(C09)=='C09.88'~88,
                                  trimws(C09)=='C09.99'~99)),
         C101=as.numeric(case_when(trimws(C101)=='C10.1'~1,
                                   trimws(C101)=='C10.2'~2,
                                   trimws(C101)=='C10.3'~3,
                                   trimws(C101)=='C10.4'~4,
                                   trimws(C101)=='C10.5'~5,
                                   trimws(C101)=='C10.6'~6,
                                   trimws(C101)=='C10.7'~7,
                                   trimws(C101)=='C10.8'~8,
                                   trimws(C101)=='C10.9'~9)),
         C102=as.numeric(case_when(trimws(C102)=='C10.1'~1,
                                   trimws(C102)=='C10.2'~2,
                                   trimws(C102)=='C10.3'~3,
                                   trimws(C102)=='C10.4'~4,
                                   trimws(C102)=='C10.5'~5,
                                   trimws(C102)=='C10.6'~6,
                                   trimws(C102)=='C10.7'~7,
                                   trimws(C102)=='C10.8'~8,
                                   trimws(C102)=='C10.9'~9,
                                   trimws(C102)=='C10.99'~99)),
         C103=as.numeric(case_when(trimws(C103)=='C10.1'~1,
                                   trimws(C103)=='C10.2'~2,
                                   trimws(C103)=='C10.3'~3,
                                   trimws(C103)=='C10.4'~4,
                                   trimws(C103)=='C10.5'~5,
                                   trimws(C103)=='C10.6'~6,
                                   trimws(C103)=='C10.7'~7,
                                   trimws(C103)=='C10.8'~8,
                                   trimws(C103)=='C10.9'~9,
                                   trimws(C103)=='C10.99'~99)),
         C104=as.numeric(case_when(trimws(C104)=='C10.1'~1,
                                   trimws(C104)=='C10.2'~2,
                                   trimws(C104)=='C10.3'~3,
                                   trimws(C104)=='C10.4'~4,
                                   trimws(C104)=='C10.5'~5,
                                   trimws(C104)=='C10.6'~6,
                                   trimws(C104)=='C10.7'~7,
                                   trimws(C104)=='C10.8'~8,
                                   trimws(C104)=='C10.9'~9,
                                   trimws(C104)=='C10.99'~99))
  ) 



colnames(visita)

table(d$tipo)

visita$A01municipio <- stringr::str_replace(visita$A01municipio, "Águas Lindas", "5200258")

as.numeric(x)
as.logical(x)
as.character(x)
as.factor(x)